version: 1.0
type: REST_API
buildSpec:
  source:
    directory: .
  build:
    docker:
      file: Dockerfile
      context: .
  env:
    - name: OLLAMA_API_URL
      value: "http://localhost:11434"
    - name: OLLAMA_MODEL
      value: "deepseek-coder"
    - name: OLLAMA_TIMEOUT_SECONDS
      value: "120"
  resources:
    - type: compute
      name: default-compute
      size: large
      scaling:
        minReplicas: 1
        maxReplicas: 1
  ports:
    - name: http
      port: 8080
      type: http
    - name: ollama
      port: 11434
      type: tcp
  healthCheck:
    port: 8080
    path: /health
    initialDelaySeconds: 60
    periodSeconds: 30
    failureThreshold: 3
metadata:
  name: deepseek-coder-api
  description: DeepSeek Coder API with integrated Ollama service
  tags:
    - ai
    - code-generation
    - ollama
    - deepseek
  labels:
    version: 1.0.0
endpoints:
  - name: default
    type: REST
    context: /
    port: 8080
    visibility: PUBLIC
    cors:
      enabled: true
      allowOrigins:
        - "*"
      allowMethods:
        - GET
        - POST
      allowHeaders:
        - "*"
security:
  authentication:
    enabled: true
    type: OAuth2
  rateLimit:
    enabled: true
    requestsPerUnit: 100
    unit: MINUTE
deploy:
  restApi:
    port: 8080
    basePath: /
    cors:
      enabled: true
      allowOrigins:
        - "*"
    security:
      enabled: true
      authTypes:
        - OAuth2
    resources:
      - path: /health
        operations:
          - method: GET
            secured: false
      - path: /api/v1/model
        operations:
          - method: GET
      - path: /api/v1/generate
        operations:
          - method: POST 